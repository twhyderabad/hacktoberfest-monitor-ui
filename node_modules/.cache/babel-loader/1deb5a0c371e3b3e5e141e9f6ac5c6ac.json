{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime-corejs2/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs2/core-js/object/define-property\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports[\"default\"] = void 0;\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/objectSpread\"));\n\nvar _keys = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/object/keys\"));\n\nvar _isArray = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/array/is-array\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/typeof\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/getPrototypeOf\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/assertThisInitialized\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/inherits\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/defineProperty\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _pick2 = _interopRequireDefault(require(\"lodash/pick\"));\n\nvar _get2 = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _isEmpty2 = _interopRequireDefault(require(\"lodash/isEmpty\"));\n\nvar _ErrorList = _interopRequireDefault(require(\"./ErrorList\"));\n\nvar _utils = require(\"../utils\");\n\nvar _validate = _interopRequireWildcard(require(\"../validate\"));\n\nvar Form =\n/*#__PURE__*/\nfunction (_Component) {\n  (0, _inherits2[\"default\"])(Form, _Component);\n\n  function Form(props) {\n    var _this;\n\n    (0, _classCallCheck2[\"default\"])(this, Form);\n    _this = (0, _possibleConstructorReturn2[\"default\"])(this, (0, _getPrototypeOf2[\"default\"])(Form).call(this, props));\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"getUsedFormData\", function (formData, fields) {\n      //for the case of a single input form\n      if (fields.length === 0 && (0, _typeof2[\"default\"])(formData) !== \"object\") {\n        return formData;\n      }\n\n      var data = (0, _pick2[\"default\"])(formData, fields);\n\n      if ((0, _isArray[\"default\"])(formData)) {\n        return (0, _keys[\"default\"])(data).map(function (key) {\n          return data[key];\n        });\n      }\n\n      return data;\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"getFieldNames\", function (pathSchema, formData) {\n      var getAllPaths = function getAllPaths(_obj) {\n        var acc = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n        var paths = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [\"\"];\n        (0, _keys[\"default\"])(_obj).forEach(function (key) {\n          if ((0, _typeof2[\"default\"])(_obj[key]) === \"object\") {\n            var newPaths = paths.map(function (path) {\n              return \"\".concat(path, \".\").concat(key);\n            });\n            getAllPaths(_obj[key], acc, newPaths);\n          } else if (key === \"$name\" && _obj[key] !== \"\") {\n            paths.forEach(function (path) {\n              path = path.replace(/^\\./, \"\");\n              var formValue = (0, _get2[\"default\"])(formData, path); // adds path to fieldNames if it points to a value\n              // or an empty object/array\n\n              if ((0, _typeof2[\"default\"])(formValue) !== \"object\" || (0, _isEmpty2[\"default\"])(formValue)) {\n                acc.push(path);\n              }\n            });\n          }\n        });\n        return acc;\n      };\n\n      return getAllPaths(pathSchema);\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"onChange\", function (formData, newErrorSchema) {\n      if ((0, _utils.isObject)(formData) || (0, _isArray[\"default\"])(formData)) {\n        var newState = _this.getStateFromProps(_this.props, formData);\n\n        formData = newState.formData;\n      }\n\n      var mustValidate = !_this.props.noValidate && _this.props.liveValidate;\n      var state = {\n        formData: formData\n      };\n      var newFormData = formData;\n\n      if (_this.props.omitExtraData === true && _this.props.liveOmit === true) {\n        var retrievedSchema = (0, _utils.retrieveSchema)(_this.state.schema, _this.state.schema.definitions, formData);\n        var pathSchema = (0, _utils.toPathSchema)(retrievedSchema, \"\", _this.state.schema.definitions, formData);\n\n        var fieldNames = _this.getFieldNames(pathSchema, formData);\n\n        newFormData = _this.getUsedFormData(formData, fieldNames);\n        state = {\n          formData: newFormData\n        };\n      }\n\n      if (mustValidate) {\n        var _this$validate = _this.validate(newFormData),\n            errors = _this$validate.errors,\n            errorSchema = _this$validate.errorSchema;\n\n        state = {\n          formData: newFormData,\n          errors: errors,\n          errorSchema: errorSchema\n        };\n      } else if (!_this.props.noValidate && newErrorSchema) {\n        state = {\n          formData: newFormData,\n          errorSchema: newErrorSchema,\n          errors: (0, _validate.toErrorList)(newErrorSchema)\n        };\n      }\n\n      (0, _utils.setState)((0, _assertThisInitialized2[\"default\"])(_this), state, function () {\n        if (_this.props.onChange) {\n          _this.props.onChange(_this.state);\n        }\n      });\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"onBlur\", function () {\n      if (_this.props.onBlur) {\n        var _this$props;\n\n        (_this$props = _this.props).onBlur.apply(_this$props, arguments);\n      }\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"onFocus\", function () {\n      if (_this.props.onFocus) {\n        var _this$props2;\n\n        (_this$props2 = _this.props).onFocus.apply(_this$props2, arguments);\n      }\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"onSubmit\", function (event) {\n      event.preventDefault();\n\n      if (event.target !== event.currentTarget) {\n        return;\n      }\n\n      event.persist();\n      var newFormData = _this.state.formData;\n\n      if (_this.props.omitExtraData === true) {\n        var retrievedSchema = (0, _utils.retrieveSchema)(_this.state.schema, _this.state.schema.definitions, newFormData);\n        var pathSchema = (0, _utils.toPathSchema)(retrievedSchema, \"\", _this.state.schema.definitions, newFormData);\n\n        var fieldNames = _this.getFieldNames(pathSchema, newFormData);\n\n        newFormData = _this.getUsedFormData(newFormData, fieldNames);\n      }\n\n      if (!_this.props.noValidate) {\n        var _this$validate2 = _this.validate(newFormData),\n            errors = _this$validate2.errors,\n            errorSchema = _this$validate2.errorSchema;\n\n        if ((0, _keys[\"default\"])(errors).length > 0) {\n          (0, _utils.setState)((0, _assertThisInitialized2[\"default\"])(_this), {\n            errors: errors,\n            errorSchema: errorSchema\n          }, function () {\n            if (_this.props.onError) {\n              _this.props.onError(errors);\n            } else {\n              console.error(\"Form validation failed\", errors);\n            }\n          });\n          return;\n        }\n      }\n\n      _this.setState({\n        formData: newFormData,\n        errors: [],\n        errorSchema: {}\n      }, function () {\n        if (_this.props.onSubmit) {\n          _this.props.onSubmit((0, _objectSpread2[\"default\"])({}, _this.state, {\n            formData: newFormData,\n            status: \"submitted\"\n          }), event);\n        }\n      });\n    });\n    _this.state = _this.getStateFromProps(props, props.formData);\n\n    if (_this.props.onChange && !(0, _utils.deepEquals)(_this.state.formData, _this.props.formData)) {\n      _this.props.onChange(_this.state);\n    }\n\n    _this.formElement = null;\n    return _this;\n  }\n\n  (0, _createClass2[\"default\"])(Form, [{\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      var nextState = this.getStateFromProps(nextProps, nextProps.formData);\n\n      if (!(0, _utils.deepEquals)(nextState.formData, nextProps.formData) && !(0, _utils.deepEquals)(nextState.formData, this.state.formData) && this.props.onChange) {\n        this.props.onChange(nextState);\n      }\n\n      this.setState(nextState);\n    }\n  }, {\n    key: \"getStateFromProps\",\n    value: function getStateFromProps(props, inputFormData) {\n      var state = this.state || {};\n      var schema = \"schema\" in props ? props.schema : this.props.schema;\n      var uiSchema = \"uiSchema\" in props ? props.uiSchema : this.props.uiSchema;\n      var edit = typeof inputFormData !== \"undefined\";\n      var liveValidate = props.liveValidate || this.props.liveValidate;\n      var mustValidate = edit && !props.noValidate && liveValidate;\n      var definitions = schema.definitions;\n      var formData = (0, _utils.getDefaultFormState)(schema, inputFormData, definitions);\n      var retrievedSchema = (0, _utils.retrieveSchema)(schema, definitions, formData);\n      var customFormats = props.customFormats;\n      var additionalMetaSchemas = props.additionalMetaSchemas;\n\n      var _ref = mustValidate ? this.validate(formData, schema, additionalMetaSchemas, customFormats) : {\n        errors: state.errors || [],\n        errorSchema: state.errorSchema || {}\n      },\n          errors = _ref.errors,\n          errorSchema = _ref.errorSchema;\n\n      var idSchema = (0, _utils.toIdSchema)(retrievedSchema, uiSchema[\"ui:rootFieldId\"], definitions, formData, props.idPrefix);\n      return {\n        schema: schema,\n        uiSchema: uiSchema,\n        idSchema: idSchema,\n        formData: formData,\n        edit: edit,\n        errors: errors,\n        errorSchema: errorSchema,\n        additionalMetaSchemas: additionalMetaSchemas\n      };\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps, nextState) {\n      return (0, _utils.shouldRender)(this, nextProps, nextState);\n    }\n  }, {\n    key: \"validate\",\n    value: function validate(formData) {\n      var schema = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.props.schema;\n      var additionalMetaSchemas = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.props.additionalMetaSchemas;\n      var customFormats = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : this.props.customFormats;\n      var _this$props3 = this.props,\n          validate = _this$props3.validate,\n          transformErrors = _this$props3.transformErrors;\n\n      var _this$getRegistry = this.getRegistry(),\n          definitions = _this$getRegistry.definitions;\n\n      var resolvedSchema = (0, _utils.retrieveSchema)(schema, definitions, formData);\n      return (0, _validate[\"default\"])(formData, resolvedSchema, validate, transformErrors, additionalMetaSchemas, customFormats);\n    }\n  }, {\n    key: \"renderErrors\",\n    value: function renderErrors() {\n      var _this$state = this.state,\n          errors = _this$state.errors,\n          errorSchema = _this$state.errorSchema,\n          schema = _this$state.schema,\n          uiSchema = _this$state.uiSchema;\n      var _this$props4 = this.props,\n          ErrorList = _this$props4.ErrorList,\n          showErrorList = _this$props4.showErrorList,\n          formContext = _this$props4.formContext;\n\n      if (errors.length && showErrorList != false) {\n        return _react[\"default\"].createElement(ErrorList, {\n          errors: errors,\n          errorSchema: errorSchema,\n          schema: schema,\n          uiSchema: uiSchema,\n          formContext: formContext\n        });\n      }\n\n      return null;\n    }\n  }, {\n    key: \"getRegistry\",\n    value: function getRegistry() {\n      // For BC, accept passed SchemaField and TitleField props and pass them to\n      // the \"fields\" registry one.\n      var _getDefaultRegistry = (0, _utils.getDefaultRegistry)(),\n          fields = _getDefaultRegistry.fields,\n          widgets = _getDefaultRegistry.widgets;\n\n      return {\n        fields: (0, _objectSpread2[\"default\"])({}, fields, this.props.fields),\n        widgets: (0, _objectSpread2[\"default\"])({}, widgets, this.props.widgets),\n        ArrayFieldTemplate: this.props.ArrayFieldTemplate,\n        ObjectFieldTemplate: this.props.ObjectFieldTemplate,\n        FieldTemplate: this.props.FieldTemplate,\n        definitions: this.props.schema.definitions || {},\n        formContext: this.props.formContext || {}\n      };\n    }\n  }, {\n    key: \"submit\",\n    value: function submit() {\n      if (this.formElement) {\n        this.formElement.dispatchEvent(new Event(\"submit\", {\n          cancelable: true\n        }));\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props5 = this.props,\n          children = _this$props5.children,\n          safeRenderCompletion = _this$props5.safeRenderCompletion,\n          id = _this$props5.id,\n          idPrefix = _this$props5.idPrefix,\n          className = _this$props5.className,\n          tagName = _this$props5.tagName,\n          name = _this$props5.name,\n          method = _this$props5.method,\n          target = _this$props5.target,\n          action = _this$props5.action,\n          autocomplete = _this$props5.autocomplete,\n          enctype = _this$props5.enctype,\n          acceptcharset = _this$props5.acceptcharset,\n          noHtml5Validate = _this$props5.noHtml5Validate,\n          disabled = _this$props5.disabled,\n          formContext = _this$props5.formContext;\n      var _this$state2 = this.state,\n          schema = _this$state2.schema,\n          uiSchema = _this$state2.uiSchema,\n          formData = _this$state2.formData,\n          errorSchema = _this$state2.errorSchema,\n          idSchema = _this$state2.idSchema;\n      var registry = this.getRegistry();\n      var _SchemaField = registry.fields.SchemaField;\n      var FormTag = tagName ? tagName : \"form\";\n      return _react[\"default\"].createElement(FormTag, {\n        className: className ? className : \"rjsf\",\n        id: id,\n        name: name,\n        method: method,\n        target: target,\n        action: action,\n        autoComplete: autocomplete,\n        encType: enctype,\n        acceptCharset: acceptcharset,\n        noValidate: noHtml5Validate,\n        onSubmit: this.onSubmit,\n        ref: function ref(form) {\n          _this2.formElement = form;\n        }\n      }, this.renderErrors(), _react[\"default\"].createElement(_SchemaField, {\n        schema: schema,\n        uiSchema: uiSchema,\n        errorSchema: errorSchema,\n        idSchema: idSchema,\n        idPrefix: idPrefix,\n        formContext: formContext,\n        formData: formData,\n        onChange: this.onChange,\n        onBlur: this.onBlur,\n        onFocus: this.onFocus,\n        registry: registry,\n        safeRenderCompletion: safeRenderCompletion,\n        disabled: disabled\n      }), children ? children : _react[\"default\"].createElement(\"div\", null, _react[\"default\"].createElement(\"button\", {\n        type: \"submit\",\n        className: \"btn btn-info\"\n      }, \"Submit\")));\n    }\n  }]);\n  return Form;\n}(_react.Component);\n\nexports[\"default\"] = Form;\n(0, _defineProperty2[\"default\"])(Form, \"defaultProps\", {\n  uiSchema: {},\n  noValidate: false,\n  liveValidate: false,\n  disabled: false,\n  safeRenderCompletion: false,\n  noHtml5Validate: false,\n  ErrorList: _ErrorList[\"default\"],\n  omitExtraData: false\n});\n\nif (process.env.NODE_ENV !== \"production\") {\n  Form.propTypes = {\n    schema: _propTypes[\"default\"].object.isRequired,\n    uiSchema: _propTypes[\"default\"].object,\n    formData: _propTypes[\"default\"].any,\n    widgets: _propTypes[\"default\"].objectOf(_propTypes[\"default\"].oneOfType([_propTypes[\"default\"].func, _propTypes[\"default\"].object])),\n    fields: _propTypes[\"default\"].objectOf(_propTypes[\"default\"].func),\n    ArrayFieldTemplate: _propTypes[\"default\"].func,\n    ObjectFieldTemplate: _propTypes[\"default\"].func,\n    FieldTemplate: _propTypes[\"default\"].func,\n    ErrorList: _propTypes[\"default\"].func,\n    onChange: _propTypes[\"default\"].func,\n    onError: _propTypes[\"default\"].func,\n    showErrorList: _propTypes[\"default\"].bool,\n    onSubmit: _propTypes[\"default\"].func,\n    id: _propTypes[\"default\"].string,\n    className: _propTypes[\"default\"].string,\n    tagName: _propTypes[\"default\"].string,\n    name: _propTypes[\"default\"].string,\n    method: _propTypes[\"default\"].string,\n    target: _propTypes[\"default\"].string,\n    action: _propTypes[\"default\"].string,\n    autocomplete: _propTypes[\"default\"].string,\n    enctype: _propTypes[\"default\"].string,\n    acceptcharset: _propTypes[\"default\"].string,\n    noValidate: _propTypes[\"default\"].bool,\n    noHtml5Validate: _propTypes[\"default\"].bool,\n    liveValidate: _propTypes[\"default\"].bool,\n    validate: _propTypes[\"default\"].func,\n    transformErrors: _propTypes[\"default\"].func,\n    safeRenderCompletion: _propTypes[\"default\"].bool,\n    formContext: _propTypes[\"default\"].object,\n    customFormats: _propTypes[\"default\"].object,\n    additionalMetaSchemas: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].object),\n    omitExtraData: _propTypes[\"default\"].bool\n  };\n}","map":null,"metadata":{},"sourceType":"script"}